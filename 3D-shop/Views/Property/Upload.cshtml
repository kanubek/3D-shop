@model UploadPropertyViewModel
@{
    ViewData["Title"] = "–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏";
}

<div class="page-header">
    <div class="container">
        <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h1>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, –ò–ò –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç 3D –º–æ–¥–µ–ª—å</p>
    </div>
</div>

<div class="upload-section">
    <div class="container">
        <form asp-action="Upload" method="post" enctype="multipart/form-data" class="property-form">
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section">
                <h2>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label asp-for="Property.Title">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ *</label>
                        <input asp-for="Property.Title" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—é—Ç–Ω–∞—è 3-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ" required />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label asp-for="Property.PropertyType">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ *</label>
                        <select asp-for="Property.PropertyType" class="form-control" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="–ö–≤–∞—Ä—Ç–∏—Ä–∞">–ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
                            <option value="–î–æ–º">–î–æ–º</option>
                            <option value="–ö–æ—Ç—Ç–µ–¥–∂">–ö–æ—Ç—Ç–µ–¥–∂</option>
                            <option value="–¢–∞—É–Ω—Ö–∞—É—Å">–¢–∞—É–Ω—Ö–∞—É—Å</option>
                            <option value="–°—Ç—É–¥–∏—è">–°—Ç—É–¥–∏—è</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label asp-for="Property.Price">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                        <input asp-for="Property.Price" type="number" class="form-control" placeholder="5000000" required />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label asp-for="Property.Address">–ê–¥—Ä–µ—Å *</label>
                        <input asp-for="Property.Address" class="form-control" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º" required />
                    </div>
                </div>
                
                <div class="form-group">
                    <label asp-for="Property.Description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea asp-for="Property.Description" class="form-control" rows="4" 
                              placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞..."></textarea>
                </div>
            </div>

            <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
            <div class="form-section">
                <h2>üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label asp-for="Property.Area">–ü–ª–æ—â–∞–¥—å (–º¬≤) *</label>
                        <input asp-for="Property.Area" type="number" step="0.1" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label asp-for="Property.Rooms">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                        <select asp-for="Property.Rooms" class="form-control">
                            <option value="0">–°—Ç—É–¥–∏—è</option>
                            <option value="1">1 –∫–æ–º–Ω–∞—Ç–∞</option>
                            <option value="2">2 –∫–æ–º–Ω–∞—Ç—ã</option>
                            <option value="3">3 –∫–æ–º–Ω–∞—Ç—ã</option>
                            <option value="4">4 –∫–æ–º–Ω–∞—Ç—ã</option>
                            <option value="5">5+ –∫–æ–º–Ω–∞—Ç</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label asp-for="Property.Floor">–≠—Ç–∞–∂</label>
                        <input asp-for="Property.Floor" type="number" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Property.TotalFloors">–≠—Ç–∞–∂–µ–π –≤ –¥–æ–º–µ</label>
                        <input asp-for="Property.TotalFloors" type="number" class="form-control" />
                    </div>
                </div>
            </div>

            <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –ò–ò -->
            <div class="form-section">
                <h2>üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –ò–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 3D</h2>
                <div class="upload-info">
                    <div class="ai-tips">
                        <h3>ü§ñ –°–æ–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ò–ò:</h3>
                        <ul>
                            <li>üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–∏–Ω–∏–º—É–º 5-10 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∫—É—Ä—Å–æ–≤</li>
                            <li>üè† –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—É—é –∫–æ–º–Ω–∞—Ç—É –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Å 2-3 —Å—Ç–æ—Ä–æ–Ω</li>
                            <li>üí° –û–±–µ—Å–ø–µ—á—å—Ç–µ —Ö–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</li>
                            <li>üìê –í–∫–ª—é—á–∏—Ç–µ —É–≥–ª—ã –∫–æ–º–Ω–∞—Ç –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –ø–æ–º–µ—â–µ–Ω–∏—è–º–∏</li>
                            <li>üö™ –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥—ã, –æ–∫–Ω–∞, –±–∞–ª–∫–æ–Ω—ã</li>
                        </ul>
                    </div>
                </div>
                
                <div class="file-upload-area" id="uploadArea">
                    <div class="upload-zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
                        <div class="upload-icon">üìÅ</div>
                        <h3>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h3>
                        <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, HEIC (–º–∞–∫—Å. 10MB –∫–∞–∂–¥—ã–π)</p>
                        <input type="file" asp-for="UploadedImages" multiple accept="image/*" class="file-input" id="fileInput" onchange="handleFiles(this.files)" />
                        <button type="button" class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
                            –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                        </button>
                    </div>
                </div>
                
                <div class="uploaded-files" id="uploadedFiles"></div>
            </div>

            <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section">
                <h2>üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <div class="form-group">
                    <label asp-for="Property.ContactInfo">–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏ *</label>
                    <input asp-for="Property.ContactInfo" type="tel" class="form-control" placeholder="+7 (999) 123-45-67" required />
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    üöÄ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ò–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
                </button>
                <a href="/Property" class="btn btn-outline">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        let uploadedFiles = [];
        
        function dragOverHandler(ev) {
            ev.preventDefault();
            ev.dataTransfer.dropEffect = "copy";
            document.getElementById('uploadArea').classList.add('drag-over');
        }
        
        function dropHandler(ev) {
            ev.preventDefault();
            document.getElementById('uploadArea').classList.remove('drag-over');
            
            const files = ev.dataTransfer.files;
            handleFiles(files);
        }
        
        function handleFiles(files) {
            const filesArray = Array.from(files);
            const validFiles = filesArray.filter(file => {
                if (!file.type.startsWith('image/')) {
                    alert(`–§–∞–π–ª ${file.name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º`);
                    return false;
                }
                if (file.size > 10 * 1024 * 1024) {
                    alert(`–§–∞–π–ª ${file.name} –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10MB`);
                    return false;
                }
                return true;
            });
            
            uploadedFiles = uploadedFiles.concat(validFiles);
            displayUploadedFiles();
        }
        
        function displayUploadedFiles() {
            const container = document.getElementById('uploadedFiles');
            container.innerHTML = '';
            
            if (uploadedFiles.length > 0) {
                const title = document.createElement('h3');
                title.textContent = `üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: ${uploadedFiles.length}`;
                container.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'files-grid';
                
                uploadedFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.alt = file.name;
                    
                    const name = document.createElement('p');
                    name.textContent = file.name;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = '‚ùå';
                    removeBtn.type = 'button';
                    removeBtn.onclick = () => removeFile(index);
                    
                    fileItem.appendChild(img);
                    fileItem.appendChild(name);
                    fileItem.appendChild(removeBtn);
                    grid.appendChild(fileItem);
                });
                
                container.appendChild(grid);
                
                // AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                if (uploadedFiles.length >= 5) {
                    const aiPreview = document.createElement('div');
                    aiPreview.className = 'ai-preview';
                    aiPreview.innerHTML = `
                        <h4>ü§ñ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ò–ò:</h4>
                        <div class="ai-analysis">
                            <span class="ai-check">‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è 3D –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</span>
                            <span class="ai-check">‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–¥—Ö–æ–¥—è—â–µ–µ</span>
                            <span class="ai-estimate">‚è±Ô∏è –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 2-3 –º–∏–Ω—É—Ç—ã</span>
                        </div>
                    `;
                    container.appendChild(aiPreview);
                }
            }
        }
        
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displayUploadedFiles();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.querySelector('form').addEventListener('submit', function(e) {
            if (uploadedFiles.length === 0) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –¥–ª—è –ò–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏');
                return;
            }
            
            if (uploadedFiles.length < 3) {
                if (!confirm('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–Ω–∏–º—É–º 3-5 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ 3D –º–æ–¥–µ–ª–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                    e.preventDefault();
                    return;
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.innerHTML = 'üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ò–ò...';
            submitBtn.disabled = true;
        });
    </script>
}