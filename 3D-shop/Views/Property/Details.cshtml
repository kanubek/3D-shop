@model Property

@{
    ViewData["Title"] = $"{Model.Title} - –î–µ—Ç–∞–ª–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏";
}

<div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
    <div class="property-detail-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-2">@Model.Title</h1>
                <p class="lead mb-2">@Model.Location</p>
                <div class="d-flex align-items-center gap-3">
                    <span class="badge bg-primary">@Model.PropertyType</span>
                    <span class="text-muted">ID: @Model.Id</span>
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                <h2 class="price-tag mb-0">@RealEstate3D.Helpers.CurrencyHelper.FormatKyrgyzCurrency(Model.Price)</h2>
                <p class="text-muted">@RealEstate3D.Helpers.CurrencyHelper.FormatKyrgyzCurrencyShort(Model.Price / (decimal)Model.Area) –∑–∞ –º¬≤</p>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ç–æ –≥–∞–ª–µ—Ä–µ—è -->
    <div class="property-gallery">
        <div class="property-main-image">
            @if (Model.ImageUrls != null && Model.ImageUrls.Any())
            {
                <img id="mainImage" src="@Model.ImageUrls.First()" alt="@Model.Title" />
            }
            else
            {
                <img src="/images/no-image.svg" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" />
            }
        </div>
        
        @if (Model.ImageUrls != null && Model.ImageUrls.Count > 1)
        {
            <div class="property-thumbnails">
                @for (int i = 0; i < Math.Min(Model.ImageUrls.Count, 4); i++)
                {
                    <div class="property-thumbnail @(i == 0 ? "active" : "")" onclick="changeMainImage('@Model.ImageUrls[i]', this)">
                        <img src="@Model.ImageUrls[i]" alt="@Model.Title" />
                    </div>
                }
                @if (Model.ImageUrls.Count > 4)
                {
                    <div class="property-thumbnail more-photos">
                        <span>+@(Model.ImageUrls.Count - 4) —Ñ–æ—Ç–æ</span>
                    </div>
                }
            </div>
        }
    </div>

    <!-- 3D –í—å—é–≤–µ—Ä -->
    <div class="viewer-3d-container">
        <div id="model3d" data-model-url="@Model.Model3DUrl"></div>
        
        <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã –≤—å—é–≤–µ—Ä–∞ -->
        <div class="viewer-controls">
            <button class="control-btn" onclick="resetCamera()" title="–°–±—Ä–æ—Å–∏—Ç—å –∫–∞–º–µ—Ä—É">
                üì∑
            </button>
            <button class="control-btn" onclick="toggleWireframe()" title="–ö–∞—Ä–∫–∞—Å">
                üîß
            </button>
            <button class="control-btn" onclick="toggleAutoRotate()" title="–ê–≤—Ç–æ-–ø–æ–≤–æ—Ä–æ—Ç">
                üîÑ
            </button>
            <button class="control-btn" onclick="toggleFullscreen()" title="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω">
                üîç
            </button>
            <button class="control-btn" onclick="takeScreenshot()" title="–°–∫—Ä–∏–Ω—à–æ—Ç">
                üì∏
            </button>
            <button class="control-btn" onclick="toggleSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                ‚öôÔ∏è
            </button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="viewer-settings" class="viewer-settings" style="display: none;">
            <h4>üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—å—é–≤–µ—Ä–∞</h4>
            <div class="setting-group">
                <label>–û—Å–≤–µ—â–µ–Ω–∏–µ:</label>
                <input type="range" id="lighting-intensity" min="0" max="2" step="0.1" value="1">
            </div>
            <div class="setting-group">
                <label>–ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ–Ω–µ–π:</label>
                <select id="shadow-quality">
                    <option value="low">–ù–∏–∑–∫–æ–µ</option>
                    <option value="medium" selected>–°—Ä–µ–¥–Ω–µ–µ</option>
                    <option value="high">–í—ã—Å–æ–∫–æ–µ</option>
                </select>
            </div>
            <div class="setting-group">
                <label>–§–æ–Ω:</label>
                <select id="background-type">
                    <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
                    <option value="sky">–ù–µ–±–æ</option>
                    <option value="dark">–¢–µ–º–Ω—ã–π</option>
                </select>
            </div>
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="show-grid" checked> –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É
                </label>
            </div>
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="show-measurements"> –ò–∑–º–µ—Ä–µ–Ω–∏—è
                </label>
            </div>
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="show-tour-points"> –¢–æ—á–∫–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞
                </label>
            </div>
        </div>

        <!-- –†–µ–∂–∏–º—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
        <div class="view-modes">
            <button class="view-mode-btn active" data-mode="normal">–û–±—ã—á–Ω—ã–π</button>
            <button class="view-mode-btn" data-mode="cinematic">–ö–∏–Ω–æ</button>
            <button class="view-mode-btn" data-mode="blueprint">–ß–µ—Ä—Ç–µ–∂</button>
            <button class="view-mode-btn" data-mode="vr">VR</button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –∏–∑–º–µ—Ä–µ–Ω–∏–π -->
        <div id="measurement-tools" class="measurement-tools">
            <h5>üìè –ò–∑–º–µ—Ä–µ–Ω–∏—è</h5>
            <div class="measurement-item">
                <span class="measurement-label">–î–ª–∏–Ω–∞:</span>
                <span class="measurement-value" id="length-measure">--</span>
            </div>
            <div class="measurement-item">
                <span class="measurement-label">–®–∏—Ä–∏–Ω–∞:</span>
                <span class="measurement-value" id="width-measure">--</span>
            </div>
            <div class="measurement-item">
                <span class="measurement-label">–í—ã—Å–æ—Ç–∞:</span>
                <span class="measurement-value" id="height-measure">--</span>
            </div>
            <div class="measurement-item">
                <span class="measurement-label">–ü–ª–æ—â–∞–¥—å:</span>
                <span class="measurement-value" id="area-measure">--</span>
            </div>
        </div>

        <!-- –¢–æ—á–∫–∏ —Ç—É—Ä–∞ -->
        <div class="tour-points" id="tour-points">
            <!-- –¢–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏ -->
        <div class="viewer-info">
            <h4>üè† 3D –ú–æ–¥–µ–ª—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h4>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—ã—à—å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: <br>
            ‚Ä¢ –õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ - –ø–æ–≤–æ—Ä–æ—Ç <br>
            ‚Ä¢ –ö–æ–ª–µ—Å–∏–∫–æ - –º–∞—Å—à—Ç–∞–± <br>
            ‚Ä¢ –ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ - –ø–∞–Ω–æ—Ä–∞–º–∞</p>
        </div>

        <!-- –õ–æ–∞–¥–µ—Ä -->
        <div id="model-loader" style="display: none;">
            <div class="loader-spinner"></div>
            <div class="loader-text">–ó–∞–≥—Ä—É–∂–∞–µ–º 3D –º–æ–¥–µ–ª—å...</div>
            <div class="loader-progress">
                <div class="loader-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
    <div class="property-specs">
        <div class="spec-item">
            <div class="icon">üè†</div>
            <div class="label">–ü–ª–æ—â–∞–¥—å</div>
            <div class="value">@Model.Area –º¬≤</div>
        </div>
        <div class="spec-item">
            <div class="icon">üö™</div>
            <div class="label">–ö–æ–º–Ω–∞—Ç—ã</div>
            <div class="value">@Model.Rooms</div>
        </div>
        <div class="spec-item">
            <div class="icon">üìç</div>
            <div class="label">–≠—Ç–∞–∂</div>
            <div class="value">@(Model.Id % 10 + 1) / @(Model.Id % 5 + 5)</div>
        </div>
        <div class="spec-item">
            <div class="icon">üèóÔ∏è</div>
            <div class="label">–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="value">@(2020 - (Model.Id % 20))</div>
        </div>
        <div class="spec-item">
            <div class="icon">üöó</div>
            <div class="label">–ü–∞—Ä–∫–æ–≤–∫–∞</div>
            <div class="value">@(Model.Id % 3 == 0 ? "–ï—Å—Ç—å" : "–ù–µ—Ç")</div>
        </div>
        <div class="spec-item">
            <div class="icon">üå°Ô∏è</div>
            <div class="label">–û—Ç–æ–ø–ª–µ–Ω–∏–µ</div>
            <div class="value">–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ</div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="row">
        <div class="col-md-8">
            <div class="property-description">
                <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ</h3>
                <div class="description-content">
                    <p>@Model.Description</p>
                    
                    <h4>üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:</h4>
                    <ul class="features-list">
                        <li>‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —Å –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–º –∑–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º</li>
                        <li>‚úÖ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç–∫–æ–ª–æ–≥–∏—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</li>
                        <li>‚úÖ –ü–∞–Ω–æ—Ä–∞–º–Ω—ã–µ –æ–∫–Ω–∞ —Å –≤–∏–¥–æ–º –Ω–∞ @(Model.Id % 2 == 0 ? "–ø–∞—Ä–∫" : "–≥–æ—Ä–æ–¥")</li>
                        <li>‚úÖ –†–∞–∑–≤–∏—Ç–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–π–æ–Ω–∞</li>
                        <li>‚úÖ –£–¥–æ–±–Ω–∞—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</li>
                        <li>‚úÖ –û—Ö—Ä–∞–Ω—è–µ–º–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è —Å –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º</li>
                    </ul>

                    <h4>üèòÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:</h4>
                    <div class="infrastructure-grid">
                        <span class="infra-item">üè™ –ú–∞–≥–∞–∑–∏–Ω—ã - 200–º</span>
                        <span class="infra-item">üè´ –®–∫–æ–ª–∞ - 500–º</span>
                        <span class="infra-item">üöá –ú–µ—Ç—Ä–æ - @(Model.Id % 10 + 5) –º–∏–Ω</span>
                        <span class="infra-item">üè• –ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ - 800–º</span>
                        <span class="infra-item">üå≥ –ü–∞—Ä–∫ - 300–º</span>
                        <span class="infra-item">üöå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ - 100–º</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="contact-section">
                <div class="contact-card">
                    <h4>üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</h4>
                    <div class="seller-info">
                        <div class="seller-avatar">
                            <span>üë§</span>
                        </div>
                        <div class="seller-details">
                            <h5>–ê–≥–µ–Ω—Ç –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h5>
                            <p class="text-muted">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ–¥–∞–≤–µ—Ü</p>
                        </div>
                    </div>
                    
                    <div class="contact-buttons">
                        <button class="btn btn-primary btn-block mb-2">
                            üì± –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
                        </button>
                        <button class="btn btn-outline btn-block mb-2">
                            üí¨ –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-outline btn-block">
                            ‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        </button>
                    </div>
                </div>

                <div class="quick-actions mt-4">
                    <h5>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                    <div class="action-buttons">
                        <button class="btn btn-outline-light btn-sm">
                            üìã –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫
                        </button>
                        <button class="btn btn-outline-light btn-sm">
                            üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                        <button class="btn btn-outline-light btn-sm">
                            üìä –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç –æ —Ü–µ–Ω–µ
                        </button>
                        <button class="btn btn-outline-light btn-sm">
                            üè¶ –ü–æ–º–æ—â—å —Å –∏–ø–æ—Ç–µ–∫–æ–π
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –°–º–µ–Ω–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –≥–∞–ª–µ—Ä–µ–µ
function changeMainImage(imageUrl, thumbnail) {
    document.getElementById('mainImage').src = imageUrl;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π thumbnail
    document.querySelectorAll('.property-thumbnail').forEach(thumb => {
        thumb.classList.remove('active');
    });
    thumbnail.classList.add('active');
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
document.addEventListener('DOMContentLoaded', function() {
    const phoneBtn = document.querySelector('.btn-primary');
    if (phoneBtn) {
        phoneBtn.addEventListener('click', function() {
            const phoneNumber = '+7 (495) 123-45-67';
            this.innerHTML = `üì± ${phoneNumber}`;
            this.disabled = true;
        });
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç–∑—ã–≤–æ–≤
    initReviewSystem(@Model.Id);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–ø–æ—Ç–µ—á–Ω–æ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    initMortgageCalculator(@Model.Price);
});
</script>

@section Scripts {
    <!-- Three.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    
    <!-- –ù–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="~/js/3d-viewer.js"></script>
    <script src="~/js/ai-assistant.js"></script>
    <script src="~/js/furniture-manager.js"></script>
    <script src="~/js/review-system.js"></script>
    <script src="~/js/mortgage-calculator.js"></script>
}